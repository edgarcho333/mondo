{{ 'button-style.css' | asset_url | stylesheet_tag }}
<link href="{{ 'custom-effect.css' | asset_url }}" rel="stylesheet" media="print" onload="this.media='all'">
{%- liquid
  assign section_blocks   = section.blocks
  assign se_stts          = section.settings
  assign ccount           = cart.item_count
  assign ck_lumise        = 'ck_lumise'  
  assign cart_url         = routes.cart_url
  assign cart_change_url  = routes.cart_change_url
  assign min_qty          = settings.min_qty | plus: 0
  assign compare_tt_price = 0
  assign shipping_amount  = settings.free_ship_pr.metafields.theme.shipping_money.value | default: settings.free_ship_pr.price | default: -1
  assign total_price    = cart.total_price

  assign se_style = se_stts.style
  assign se_pos = se_stts.pos

  assign gift_pr = all_products[settings.gift_wrap_pr]
  assign gift_pr_id = gift_pr.id
  assign arr_gift_id = cart.items | where: 'product_id', gift_pr_id
  if cart.note != blank
    assign style_add  = 't4s-d-none'
    assign style_edit = ''
  else
    assign style_add  = ''
    assign style_edit = 't4s-d-none'
  endif
  assign edit_item = settings.edit_item
  assign cur_code_enabled = settings.currency_code_enabled
  assign atc_ajax_enable  = settings.atc_ajax_enable
  assign cart_ajax_enable = settings.cart_ajax_enable
-%}

<svg class="t4s-d-none">
<symbol id="icon-cart-remove" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line>
</symbol>
<symbol id="icon-cart-edit" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
</symbol>
<symbol id="icon-cart-tag" viewBox="0 0 448 512">
  <path d="M48 32H197.5C214.5 32 230.7 38.74 242.7 50.75L418.7 226.7C443.7 251.7 443.7 292.3 418.7 317.3L285.3 450.7C260.3 475.7 219.7 475.7 194.7 450.7L18.75 274.7C6.743 262.7 0 246.5 0 229.5V80C0 53.49 21.49 32 48 32L48 32zM112 176C129.7 176 144 161.7 144 144C144 126.3 129.7 112 112 112C94.33 112 80 126.3 80 144C80 161.7 94.33 176 112 176z"/>
</symbol>
<symbol id="icon-cart-spinner" viewBox="0 0 66 66">
  <circle class="t4s-path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
</symbol>
<symbol id="icon-cart-check" viewBox="0 0 448 512">
  <path d="M443.3 100.7C449.6 106.9 449.6 117.1 443.3 123.3L171.3 395.3C165.1 401.6 154.9 401.6 148.7 395.3L4.686 251.3C-1.562 245.1-1.562 234.9 4.686 228.7C10.93 222.4 21.06 222.4 27.31 228.7L160 361.4L420.7 100.7C426.9 94.44 437.1 94.44 443.3 100.7H443.3z"/>
</symbol>
<symbol id="icon-cart-selected" viewBox="0 0 24 24">
<path d="M9 20l-7-7 3-3 4 4L19 4l3 3z"></path>
</symbol>
</svg>

{%- if request.design_mode -%}
<link rel="stylesheet" href="{{ 'mini-cart.css' | asset_url }}" media="print" onload="this.media='all'">
<div data-cart-wrapper id="t4s-mini_cart" data-ccount="{{ ccount }}" class="t4s-drawer t4s-drawer__right t4s-dn" aria-hidden="true">
{%- endif -%}

<div class="t4s-drawer__header">
  <span>{{ 'cart.mini_cart.title' | t }}</span>
  <button class="t4s-drawer__close" data-drawer-close aria-label="{{ 'cart.mini_cart.close_cart' | t }}">
    <svg class="t4s-iconsvg-close" role="presentation" viewBox="0 0 16 14">
      <path d="M15 0L1 14m14 0L1 0" stroke="currentColor" fill="none" fill-rule="evenodd"></path>
    </svg>
  </button>
</div>
{%- liquid
  assign free_shipping_threshold = 4000
  assign progress_percentage = cart.total_price | times: 100.0 | divided_by: free_shipping_threshold
  if progress_percentage > 100 
    assign progress_percentage = 100
  endif
-%}

<div class="t4s-shipping-progress" data-cart-total="{{ cart.total_price }}" data-threshold="{{ free_shipping_threshold }}">
  <div class="t4s-shipping-bar-container">
    <div class="t4s-shipping-bar" style="width: {{ progress_percentage }}%"></div>
  </div>
  <div class="t4s-shipping-message">
    {%- if cart.total_price < free_shipping_threshold -%}
      Add {{ free_shipping_threshold | minus: cart.total_price | money }} to unlock free shipping on AeroPress branded products!
      <span class="t4s-shipping-icon">ðŸš›</span>
    {%- else -%}
      You've got FREE shipping! 
      <span class="t4s-shipping-icon">ðŸŽ‰</span>
    {%- endif -%}
  </div>
</div>

<script>
document.addEventListener('cart:updated', function(event) {
  if (!event.detail || !event.detail.cart) return;
  
  const progressBar = document.querySelector('.t4s-shipping-progress');
  if (!progressBar) return;
  
  const threshold = parseInt(progressBar.dataset.threshold);
  const cartTotal = event.detail.cart.total_price;
  const remaining = Math.max(0, threshold - cartTotal);
  const percentage = Math.min(100, (cartTotal / threshold) * 100);
  
  const bar = progressBar.querySelector('.t4s-shipping-bar');
  const message = progressBar.querySelector('.t4s-shipping-message');
  
  if (bar) bar.style.width = percentage + '%';
  
  if (message) {
    if (cartTotal < threshold) {
      const formattedRemaining = (remaining / 100).toLocaleString('en-US', {
        style: 'currency',
        currency: '{{ cart.currency.iso_code }}'
      });
      message.innerHTML = `Add ${formattedRemaining} to unlock free shipping on AeroPress branded products! <span class="t4s-shipping-icon">ðŸš›</span>`;
    } else {
      message.innerHTML = `You've got FREE shipping! <span class="t4s-shipping-icon">ðŸŽ‰</span>`;
    }
  }
});
</script>

<style>
.t4s-shipping-progress {
  margin: 10px 15px;
}

.t4s-shipping-bar-container {
  width: 100%;
  height: 12px;
  background-color: #f0f0f0;
  border-radius: 10px;
  overflow: hidden;
}

.t4s-shipping-bar {
  height: 100%;
  background-color: #E31837;
  transition: width 0.3s ease;
  border-radius: 10px;
}

.t4s-shipping-message {
  text-align: center;
  margin-top: 8px;
  font-size: 14px;
}

.t4s-shipping-icon {
  display: inline-block;
  vertical-align: middle;
  margin-left: 5px;
}
</style>

<form action="{{ cart_url }}" method="post" novalidate class="t4s-drawer__wrap">
  <input type="hidden" data-cart-attr-rm name="attributes[collection_items_per_row]" value="">
  {%- if se_stts.enable_discount %}<input type="hidden" data-cart-discount name="discount" value="">{% endif -%}
  
  <div class="t4s-drawer__main">
    <div data-t4s-scroll-me class="t4s-drawer__scroll t4s-current-scrollbar">
      <div class="t4s-cookie-message t4s-dn">{{ 'cart.general.cookies_required' | t }}</div>
      
      {%- if se_style == '1' and se_pos == '1' %}{{- html_btn -}}{% endif -%}
     <div data-cart-items class="t4s-mini_cart__items t4s_ratioadapt t4s-product">
        {%- if ccount > 0 -%}
          {%- for item in cart.items -%}
            {%- render 'cart-item', item: item, gift_pr_id: gift_pr_id, min_qty: min_qty, compare_tt_price: compare_tt_price, cart_change_url: cart_change_url, edit_item: edit_item, cur_code_enabled: cur_code_enabled, atc_ajax_enable: atc_ajax_enable, cart_ajax_enable: cart_ajax_enable -%}
          {%- endfor -%}
        {%- else -%}
          <style>
            #t4s-mini_cart .t4s-drawer__bottom {
              opacity: 0;
              -webkit-transform: translateY(45px);
              transform: translateY(45px);
              -webkit-transition: opacity .25s cubic-bezier(.25,.46,.45,.94),-webkit-transform .25s cubic-bezier(.25,.46,.45,.94);
              transition: opacity .25s cubic-bezier(.25,.46,.45,.94),transform .25s cubic-bezier(.25,.46,.45,.94),-webkit-transform .25s cubic-bezier(.25,.46,.45,.94);
            }
          </style> 
          <div class="t4s-mini_cart__emty">
            <svg id="icon-cart-emty" widht="50" height="50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M263.4 103.4C269.7 97.18 279.8 97.18 286.1 103.4L320 137.4L353.9 103.4C360.2 97.18 370.3 97.18 376.6 103.4C382.8 109.7 382.8 119.8 376.6 126.1L342.6 160L376.6 193.9C382.8 200.2 382.8 210.3 376.6 216.6C370.3 222.8 360.2 222.8 353.9 216.6L320 182.6L286.1 216.6C279.8 222.8 269.7 222.8 263.4 216.6C257.2 210.3 257.2 200.2 263.4 193.9L297.4 160L263.4 126.1C257.2 119.8 257.2 109.7 263.4 103.4zM80 0C87.47 0 93.95 5.17 95.6 12.45L100 32H541.8C562.1 32 578.3 52.25 572.6 72.66L518.6 264.7C514.7 278.5 502.1 288 487.8 288H158.2L172.8 352H496C504.8 352 512 359.2 512 368C512 376.8 504.8 384 496 384H160C152.5 384 146.1 378.8 144.4 371.5L67.23 32H16C7.164 32 0 24.84 0 16C0 7.164 7.164 0 16 0H80zM107.3 64L150.1 256H487.8L541.8 64H107.3zM128 456C128 425.1 153.1 400 184 400C214.9 400 240 425.1 240 456C240 486.9 214.9 512 184 512C153.1 512 128 486.9 128 456zM184 480C197.3 480 208 469.3 208 456C208 442.7 197.3 432 184 432C170.7 432 160 442.7 160 456C160 469.3 170.7 480 184 480zM512 456C512 486.9 486.9 512 456 512C425.1 512 400 486.9 400 456C400 425.1 425.1 400 456 400C486.9 400 512 425.1 512 456zM456 432C442.7 432 432 442.7 432 456C432 469.3 442.7 480 456 480C469.3 480 480 469.3 480 456C480 442.7 469.3 432 456 432z"/></svg>
            <p>{{ 'cart.mini_cart.empty' | t }}</p>
            {%- assign btn_blocks = section_blocks | where: "type", 'btn' -%}
            {%- if btn_blocks.size > 0 -%}
              {%- for block in btn_blocks -%}
                {%- assign bk_stts = block.settings -%}
                {%- assign button_style = bk_stts.button_style -%}
                {%- if bk_stts.title != blank -%}
                  <p class="t4s-return-to-shop">
                    <a data-loading-bar class="t4s-btn-cart__emty t4s-btn t4s-btn-base t4s-btn-style-{{ button_style }} t4s-btn-color-{{ bk_stts.btn_cl }} {% if button_style == 'default' or button_style == 'outline' %}t4s-btn-effect-{{ bk_stts.button_effect }}{% endif %} t4s-justify-content-center t4s-truncate" href="{{ bk_stts.url | default: routes.all_products_collection_url }}">
                      {{ bk_stts.title }}
                      {%- if bk_stts.btn_icon -%}
                        <svg class="t4s-btn-icon" width="14"><use xlink:href="#t4s-icon-btn"></use></svg>
                      {%- endif -%}
                    </a>
                  </p>
                {%- endif -%}
              {%- endfor -%}
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>

      {%- unless se_style == '1' and se_pos == '1' %}{{- html_btn -}}{% endunless -%}

      {%- if se_stts.enable_pr %}
        <div class="t4s-when-cart-emty" data-cart-upsell-options='{ "baseurl":"{{ routes.product_recommendations_url }}", "limit":5, "product_id":{{ cart.items.first.product_id | default: 19041994 }}, "section_id": "mini_cart_upsell" }'></div>
      {% endif -%}

    </div>
  </div>
</form>

{%- if request.design_mode %}</div>{% endif -%}

{% schema %}
{
  "name": "Shopping Cart Widget",
  "settings": [
    {
      "type": "select",
      "id": "style",
      "options": [
        {
          "value": "1",
          "label": "Icon"
        },
        {
          "value": "2",
          "label": "Button text"
        }
      ],
      "label": "Buttons style"
    },
    {
      "type": "select",
      "id": "pos",
      "default": "2",
      "options": [
        {
          "value": "1",
          "label": "Top"
        },
        {
          "value": "2",
          "label": "Bottom"
        }
      ],
      "info": "Only working with button style icon",
      "label": "Position button icon"
    },
    {
      "type": "checkbox",
      "id": "enable_pr",
      "label": "Enable product recommendations",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_calc_ship",
      "label": "Enable calc shipping",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_note",
      "label": "Enable order notes",
      "default": true
    },
    {
      "type": "checkbox", 
      "id": "enable_rates",
      "label": "Enable shipping rates calculator",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_discount",
      "label": "Enable input box discounts codes",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_gift_wrap",
      "label": "Enable gift wrap",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "price",
      "name": "Total price",
      "limit": 1
    },
    {
      "type": "tax",
      "name": "Taxes and shipping info",
      "limit": 1
    },
    {
      "type": "agree",
      "name": "Terms,conditions checkbox",
      "limit": 1
    },
    {
      "type": "btnc",
      "name": "Button Cart",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "btn_icon",
          "label": "Enable button icon",
          "default": false
        }
      ]
    }
  ],
  "default": {
    "blocks": [
      {"type": "price"},
      {"type": "tax"},
      {"type": "agree"},
      {"type": "btnc"}
    ]
  }
}
{% endschema %}