{{ 'product-grid-CUSTOM.css' | asset_url | stylesheet_tag }}

<div class="custom-products-grid">
  <h2 class="section-title">{{ section.settings.title }}</h2>
  <div class="products-container">
    {% for product in section.settings.collection.products limit: 4 %}
      <div class="product-card">
        <div class="product-image-container">
          {% if product.featured_image %}
            <img 
              src="{{ product.featured_image | img_url: '400x' }}" 
              alt="{{ product.title }}"
              class="product-image"
              loading="lazy"
            >
          {% endif %}
          {% if product.available %}
            <span class="stock-badge">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M13.3334 4L6.00008 11.3333L2.66675 8" stroke="currentColor" stroke-width="2"/>
              </svg>
            </span>
          {% endif %}
        </div>
        <div class="product-info">
          <h3 class="product-title">{{ product.title }}</h3>
          {% if product.compare_at_price > product.price %}
            <div class="product-price">
              <span class="price-regular">{{ product.compare_at_price | money }}</span>
              <span class="price-sale">{{ product.price | money }}</span>
            </div>
          {% else %}
            <div class="product-price">
              <span class="price-regular">{{ product.price | money }}</span>
            </div>
          {% endif %}
          <button class="add-to-cart-btn" 
            onclick="addToCart('{{ product.variants.first.id }}')">
            ADD TO CART
          </button>
        </div>
      </div>
    {% endfor %}
  </div>
</div>

{% schema %}
{
  "name": "Custom Products Grid",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Choose Your Taste"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    }
  ],
  "presets": [
    {
      "name": "Custom Products Grid",
      "category": "Products"
    }
  ]
}
{% endschema %}

<script>
function addToCart(variantId) {
  fetch('/cart/add.js', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      items: [{
        id: variantId,
        quantity: 1
      }]
    })
  })
  .then(response => response.json())
  .then(data => {
    if(window.refreshCart) {
      window.refreshCart();
    }
  })
  .catch(error => {
    console.error('Error:', error);
  });
}
</script>